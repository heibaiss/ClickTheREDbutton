<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç»å¯¹ä¸è¦æŒ‰å¤§çº¢æŒ‰é’®</title>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 20px; background-color: #f4f4f4; overflow: hidden; }
        .container { 
            background: white; padding: 40px; border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); display: inline-block; 
            max-width: 450px; position: relative; z-index: 10; 
            -webkit-user-select: none; /* å…¼å®¹ Chrome/Safari/Edge */
            user-select: none;         /* æ ‡å‡†å±æ€§ */
        }
        #canvas-container { width: 200px; height: 200px; margin: 0 auto 20px; }
        
        /* æ ‡é¢˜æ ·å¼å¾®è°ƒï¼Œå¢åŠ ä¸€ç‚¹è­¦ç¤ºæ„Ÿ */
        h1 { color: #d32f2f; margin-bottom: 10px; font-weight: 900; letter-spacing: 1px; }
        
        button { 
            padding: 12px 25px; font-size: 16px; cursor: pointer; 
            background: #d32f2f; color: white; border: none; 
            border-radius: 50px; margin: 10px; transition: 0.2s;
        }
        button:hover { background: #b71c1c; transform: translateY(-2px); }
        button:disabled { background-color: #ccc; transform: none; }
        input { padding: 10px; font-size: 16px; width: 60px; text-align: center; border: 2px solid #ddd; border-radius: 10px; }
        #status { margin-top: 20px; color: #777; font-size: 14px; border-top: 1px solid #eee; padding-top: 15px; }

        .floating-icon {
            position: fixed;
            bottom: -150px; 
            width: 150px;    
            height: 150px;
            pointer-events: none; 
            z-index: 1;      
            opacity: 0.8;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="canvas-container">
        <lottie-player 
            src="1.json" 
            background="transparent" 
            speed="1" 
            style="width: 100%; height: 100%;" 
            loop 
            autoplay>
        </lottie-player>
    </div>

    <h1>âš ï¸ ä¸è¦æŒ‰å¤§çº¢æŒ‰é’®</h1>
    
    <button id="connectBtn">ğŸ”Œ è¿æ¥æŒ‰é’®è®¾å¤‡</button>
    
    <div id="controlPanel" style="display:none; margin-top: 20px;">
        <p>å¦‚æœéè¦ä¿®æ”¹æŒ‰é”®å€¼...</p>
        <input type="text" id="newKeyInput" maxlength="1" value="3">
        <button id="sendBtn">ğŸ’¾ æ—¢ç„¶ä½ éè¦æ”¹...</button>
    </div>

    <p id="status">æç¤ºï¼šçœŸçš„ï¼Œåˆ«æŒ‰å®ƒã€‚</p>
</div>

<script>
    // --- ä¸²å£éƒ¨åˆ† (ä¿æŒä¸å˜) ---
    let port;
    let writer;

    const connectBtn = document.getElementById('connectBtn');
    const sendBtn = document.getElementById('sendBtn');
    const status = document.getElementById('status');
    const controlPanel = document.getElementById('controlPanel');
    const newKeyInput = document.getElementById('newKeyInput');

    connectBtn.addEventListener('click', async () => {
        if (!navigator.serial) {
            status.innerText = "âŒ æµè§ˆå™¨ä¸æ”¯æŒä¸²å£";
            return;
        }
        try {
            port = await navigator.serial.requestPort();
            await port.open({ baudRate: 9600 });
            status.innerText = "âœ… ä½ è¿æ¥äº†å®ƒ...å¸Œæœ›ä½ çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆã€‚";
            connectBtn.disabled = true;
            connectBtn.innerText = "å·²è¿æ¥";
            controlPanel.style.display = "block";
            const textEncoder = new TextEncoderStream();
            textEncoder.readable.pipeTo(port.writable);
            writer = textEncoder.writable.getWriter();
        } catch (err) {
            status.innerText = "âŒ è¿æ¥å¤±è´¥ï¼š" + err.message;
        }
    });

    sendBtn.addEventListener('click', async () => {
        const charToSend = newKeyInput.value;
        if (writer && charToSend) {
            await writer.write(charToSend);
            status.innerText = `ğŸ‰ å®Œè›‹ï¼ŒæŒ‰é”®å˜æˆäº†: "${charToSend}"`;
        }
    });

    // --- ç‰¹æ•ˆéƒ¨åˆ† (å·²æ·»åŠ éšæœºå»¶è¿Ÿ) ---

    document.addEventListener('keydown', (event) => {
        triggerRandomEffect();
    });

    document.addEventListener('mousedown', () => {
        triggerRandomEffect();
    });

    function triggerRandomEffect() {
        // ç”Ÿæˆä¸€ä¸ª 0 åˆ° 300 æ¯«ç§’ä¹‹é—´çš„éšæœºå»¶è¿Ÿ
        // è¿™æ ·å¦‚æœä½ å¿«é€Ÿè¿æŒ‰ï¼Œå›¾æ ‡ä¸ä¼šåƒæ’é˜Ÿä¸€æ ·å‡ºæ¥ï¼Œè€Œæ˜¯ä¼šæœ‰â€œå‚å·®æ„Ÿâ€
        const randomDelay = Math.random() * 300;

        setTimeout(() => {
            spawnFloatingIcon();
        }, randomDelay);
    }

    function spawnFloatingIcon() {
        const el = document.createElement('lottie-player');
        el.src = '1.json'; 
        el.autoplay = true;
        el.loop = true;
        el.classList.add('floating-icon');

        // ä½ç½®éšæœº (10% - 90%)
        const randomLeft = Math.floor(Math.random() * 80) + 10; 
        // è§’åº¦éšæœº (-45åº¦ åˆ° +45åº¦) -> å¢åŠ äº†ä¸€äº›å€¾æ–œå¹…åº¦
        const randomRotate = Math.floor(Math.random() * 90) - 45; 
        // å¤§å°éšæœº (0.5å€ åˆ° 1.8å€) -> å¢åŠ äº†å¤§å°å·®å¼‚
        const randomScale = (Math.random() * 1.3) + 0.5;

        el.style.left = randomLeft + '%';
        // åˆå§‹çŠ¶æ€å°±å…ˆç»™ä¸€ä¸ªæ—‹è½¬
        el.style.transform = `rotate(${randomRotate}deg) scale(${randomScale})`;

        document.body.appendChild(el);

        // åŠ¨ç”»å‚æ•°
        const animation = el.animate([
            { transform: `translateY(0px) rotate(${randomRotate}deg) scale(${randomScale})`, opacity: 0.9 },
            // å‘ä¸Šé£˜ 800pxï¼Œå¹¶ä¸”æ—‹è½¬è§’åº¦åŠ å€ï¼ˆäº§ç”Ÿæ—‹è½¬ç€é£å‡ºå»çš„æ•ˆæœï¼‰
            { transform: `translateY(-900px) rotate(${randomRotate * 3}deg) scale(${randomScale})`, opacity: 0 }
        ], {
            duration: 2500, // ç¨å¾®é£æ…¢ä¸€ç‚¹ï¼ŒæŒç»­2.5ç§’
            easing: 'cubic-bezier(0.25, 1, 0.5, 1)' // ä½¿ç”¨è´å¡å°”æ›²çº¿ï¼Œè®©å®ƒèµ·æ­¥å¿«ï¼Œåé¢å‡é€Ÿï¼Œæ›´åƒæ°”çƒ
        });

        animation.onfinish = () => {
            el.remove();
        };
    }
</script>

</body>
</html>
