<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å¤§çº¢æŒ‰é’®é…ç½®å™¨</title>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 20px; background-color: #f4f4f4; overflow: hidden; /* é˜²æ­¢æ»šåŠ¨æ¡å‡ºç° */ }
        .container { 
            background: white; padding: 40px; border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); display: inline-block; 
            max-width: 450px; position: relative; z-index: 10; /* ä¿è¯é¢æ¿åœ¨ç‰¹æ•ˆå‰é¢ */
        }
        #canvas-container { width: 200px; height: 200px; margin: 0 auto 20px; }
        h1 { color: #d32f2f; margin-bottom: 10px; }
        button { 
            padding: 12px 25px; font-size: 16px; cursor: pointer; 
            background: #d32f2f; color: white; border: none; 
            border-radius: 50px; margin: 10px; transition: 0.2s;
        }
        button:hover { background: #b71c1c; transform: translateY(-2px); }
        button:disabled { background-color: #ccc; transform: none; }
        input { padding: 10px; font-size: 16px; width: 60px; text-align: center; border: 2px solid #ddd; border-radius: 10px; }
        #status { margin-top: 20px; color: #777; font-size: 14px; border-top: 1px solid #eee; padding-top: 15px; }

        /* --- æ–°å¢ï¼šé£˜æµ®ç‰¹æ•ˆçš„æ ·å¼ --- */
        .floating-icon {
            position: fixed;
            bottom: -150px; /* ä»å±å¹•åº•éƒ¨ä¸‹æ–¹èµ·é£ */
            width: 150px;    /* å›¾æ ‡å¤§å°ï¼Œå¯è°ƒæ•´ */
            height: 150px;
            pointer-events: none; /* è®©é¼ æ ‡èƒ½é€è¿‡å®ƒç‚¹å‡»åé¢çš„ä¸œè¥¿ */
            z-index: 1;      /* åœ¨èƒŒæ™¯å±‚ */
            opacity: 0.8;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="canvas-container">
        <lottie-player 
            src="1.json" 
            background="transparent" 
            speed="1" 
            style="width: 100%; height: 100%;" 
            loop 
            autoplay>
        </lottie-player>
    </div>

    <h1>å¤§çº¢æŒ‰é’®é…ç½®</h1>
    
    <button id="connectBtn">ğŸ”Œ è¿æ¥è®¾å¤‡</button>
    
    <div id="controlPanel" style="display:none; margin-top: 20px;">
        <p>è®¾ç½®æŒ‰ä¸‹æŒ‰é’®è¾“å…¥çš„å­—ç¬¦ï¼š</p>
        <input type="text" id="newKeyInput" maxlength="1" value="3">
        <button id="sendBtn">ğŸ’¾ ç¡®è®¤ä¿®æ”¹å¹¶ä¿å­˜</button>
    </div>

    <p id="status">æç¤ºï¼šç‚¹å‡»ä»»æ„ä½ç½®æˆ–æŒ‰ä¸‹å¤§çº¢æŒ‰é’®æŸ¥çœ‹ç‰¹æ•ˆ</p>
</div>

<script>
    // --- ä¸²å£ç›¸å…³é€»è¾‘ (ä¿æŒä¸å˜) ---
    let port;
    let writer;

    const connectBtn = document.getElementById('connectBtn');
    const sendBtn = document.getElementById('sendBtn');
    const status = document.getElementById('status');
    const controlPanel = document.getElementById('controlPanel');
    const newKeyInput = document.getElementById('newKeyInput');

    connectBtn.addEventListener('click', async () => {
        if (!navigator.serial) {
            status.innerText = "âŒ æµè§ˆå™¨ä¸æ”¯æŒä¸²å£ï¼Œè¯·ç”¨ Chrome/Edge";
            return;
        }
        try {
            port = await navigator.serial.requestPort();
            await port.open({ baudRate: 9600 });
            status.innerText = "âœ… è®¾å¤‡å·²è¿æ¥ï¼";
            connectBtn.disabled = true;
            connectBtn.innerText = "å·²è¿æ¥";
            controlPanel.style.display = "block";
            const textEncoder = new TextEncoderStream();
            textEncoder.readable.pipeTo(port.writable);
            writer = textEncoder.writable.getWriter();
        } catch (err) {
            status.innerText = "âŒ è¿æ¥å¤±è´¥ï¼š" + err.message;
        }
    });

    sendBtn.addEventListener('click', async () => {
        const charToSend = newKeyInput.value;
        if (writer && charToSend) {
            await writer.write(charToSend);
            status.innerText = `ğŸ‰ å·²å†™å…¥: "${charToSend}"`;
        }
    });

    // --- æ–°å¢ï¼šæŒ‰é”®ç‰¹æ•ˆé€»è¾‘ ---
    
    // ç›‘å¬é”®ç›˜æŒ‰ä¸‹äº‹ä»¶
    document.addEventListener('keydown', (event) => {
        spawnFloatingIcon();
    });

    // ä¹Ÿå¯ä»¥ç›‘å¬é¼ æ ‡ç‚¹å‡»ï¼ˆå¯é€‰ï¼‰
    document.addEventListener('mousedown', () => {
        spawnFloatingIcon();
    });

    function spawnFloatingIcon() {
        // 1. åˆ›å»ºä¸€ä¸ªæ–°çš„ Lottie æ’­æ”¾å™¨å…ƒç´ 
        const el = document.createElement('lottie-player');
        el.src = '1.json'; // æŒ‡å‘ä½ çš„æ–‡ä»¶
        el.autoplay = true;
        el.loop = true;
        el.classList.add('floating-icon'); // æ·»åŠ æ ·å¼ç±»

        // 2. éšæœºä½ç½®å’Œè§’åº¦
        // éšæœºå‡ºç°åœ¨å±å¹•å®½åº¦çš„ 10% åˆ° 90% ä¹‹é—´
        const randomLeft = Math.floor(Math.random() * 80) + 10; 
        // éšæœºæ—‹è½¬ -30åº¦ åˆ° 30åº¦
        const randomRotate = Math.floor(Math.random() * 60) - 30; 
        // éšæœºå¤§å° (0.8å€ åˆ° 1.5å€)
        const randomScale = (Math.random() * 0.7) + 0.8;

        el.style.left = randomLeft + '%';
        el.style.transform = `rotate(${randomRotate}deg) scale(${randomScale})`;

        // 3. å°†å…ƒç´ æ·»åŠ åˆ°ç½‘é¡µä¸­
        document.body.appendChild(el);

        // 4. ä½¿ç”¨ Web Animation API åˆ¶ä½œèµ·é£åŠ¨ç”»
        const animation = el.animate([
            // åˆå§‹çŠ¶æ€
            { transform: `translateY(0px) rotate(${randomRotate}deg) scale(${randomScale})`, opacity: 1 },
            // ç»“æŸçŠ¶æ€ (å¾€ä¸Šé£˜ 800pxï¼Œå¹¶ä¸”ç¨å¾®ä¾§ç§»)
            { transform: `translateY(-800px) rotate(${randomRotate * 2}deg) scale(${randomScale})`, opacity: 0 }
        ], {
            duration: 2000, // åŠ¨ç”»æŒç»­ 2 ç§’
            easing: 'ease-out' // é€Ÿåº¦ç”±å¿«å˜æ…¢
        });

        // 5. åŠ¨ç”»ç»“æŸåï¼ŒæŠŠå…ƒç´ ä»å†…å­˜ä¸­åˆ é™¤ï¼Œé˜²æ­¢ç½‘é¡µå˜å¡
        animation.onfinish = () => {
            el.remove();
        };
    }
</script>

</body>
</html>
